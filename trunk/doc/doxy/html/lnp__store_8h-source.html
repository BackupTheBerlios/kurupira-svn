<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Kurupira: /usr/home/iamscared/projects/kurupira/src/lnp/lnp_store.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.1 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>Globals</span></a></li>
  </ul></div>
<h1>/usr/home/iamscared/projects/kurupira/src/lnp/lnp_store.h</h1><a href="lnp__store_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * Copyright (C) 2004 by</span>
<a name="l00003"></a>00003 <span class="comment"> * - Diego "iamscared" Aranha &lt;iamscared[at]users.sourceforge.net&gt; &amp;</span>
<a name="l00004"></a>00004 <span class="comment"> * - Edans "snade" Flavius &lt;snade[at]users.sourceforge.net&gt;</span>
<a name="l00005"></a>00005 <span class="comment"> * </span>
<a name="l00006"></a>00006 <span class="comment"> * This program is free software; you can redistribute it and/or modify</span>
<a name="l00007"></a>00007 <span class="comment"> * it under the terms of the GNU General Public License as published by</span>
<a name="l00008"></a>00008 <span class="comment"> * the Free Software Foundation; either version 2 of the License, or</span>
<a name="l00009"></a>00009 <span class="comment"> * (at your option) any later version.</span>
<a name="l00010"></a>00010 <span class="comment"> * </span>
<a name="l00011"></a>00011 <span class="comment"> * This program is distributed in the hope that it will be useful,</span>
<a name="l00012"></a>00012 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00013"></a>00013 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00014"></a>00014 <span class="comment"> * GNU General Public License for more details.</span>
<a name="l00015"></a>00015 <span class="comment"> * </span>
<a name="l00016"></a>00016 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
<a name="l00017"></a>00017 <span class="comment"> * along with this program; if not, write to the</span>
<a name="l00018"></a>00018 <span class="comment"> * Free Software Foundation, Inc.,</span>
<a name="l00019"></a>00019 <span class="comment"> * 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.</span>
<a name="l00020"></a>00020 <span class="comment"> */</span>
<a name="l00021"></a>00021  
<a name="l00027"></a>00027 <span class="preprocessor">#ifndef _LNP_STORE_H_</span>
<a name="l00028"></a>00028 <span class="preprocessor"></span><span class="preprocessor">#define _LNP_STORE_H_</span>
<a name="l00029"></a>00029 <span class="preprocessor"></span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &lt;netinet/in.h&gt;</span>
<a name="l00031"></a>00031 
<a name="l00032"></a>00032 <span class="preprocessor">#include &lt;pthread.h&gt;</span>
<a name="l00033"></a>00033 
<a name="l00034"></a>00034 <span class="preprocessor">#include &lt;libfreedom/layer_net.h&gt;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &lt;util/util_crypto.h&gt;</span>
<a name="l00036"></a>00036 
<a name="l00037"></a>00037 <span class="preprocessor">#include "<a class="code" href="lnp__packets_8h.html">lnp_packets.h</a>"</span>
<a name="l00038"></a>00038 
<a name="l00042"></a><a class="code" href="lnp__store_8h.html#c6449c033cdd802414e7926b1571fa61">00042</a> <span class="preprocessor">#define LNP_TIME_TICK                                   500</span>
<a name="l00043"></a>00043 <span class="preprocessor"></span>
<a name="l00047"></a><a class="code" href="lnp__store_8h.html#080df358c9f56e1fc808def160e9d25f">00047</a> <span class="preprocessor">#define LNP_TIME_TICKS_PER_SECOND               (1000/LNP_TIME_TICK)</span>
<a name="l00048"></a>00048 <span class="preprocessor"></span>
<a name="l00052"></a><a class="code" href="lnp__store_8h.html#c25344f711611c26e700f906ace6ba8e">00052</a> <span class="preprocessor">#define KEY_TABLE_SIZE  0x10</span>
<a name="l00053"></a>00053 <span class="preprocessor"></span>
<a name="l00057"></a><a class="code" href="lnp__store_8h.html#9527c809549014ce4265c27f2dcc023e">00057</a> <span class="preprocessor">#define NULL_SLOT (-1)</span>
<a name="l00058"></a>00058 <span class="preprocessor"></span>
<a name="l00059"></a>00059 <span class="comment">/*</span>
<a name="l00060"></a>00060 <span class="comment"> * </span>
<a name="l00061"></a>00061 <span class="comment"> */</span>
<a name="l00062"></a><a class="code" href="lnp__store_8h.html#80b8e6b0b534147058fcfc1187079064">00062</a> <span class="preprocessor">#define USED_SLOT (-2)</span>
<a name="l00063"></a>00063 <span class="preprocessor"></span>
<a name="l00067"></a><a class="code" href="lnp__store_8h.html#62ef170eb4243b31e534d0eabcf4ef03">00067</a> <span class="keyword">enum</span> <a class="code" href="lnp__store_8h.html#62ef170eb4243b31e534d0eabcf4ef03">lnp_handshake_states</a> {
<a name="l00069"></a>00069         <a class="code" href="lnp__store_8h.html#62ef170eb4243b31e534d0eabcf4ef0398c169fae9f606f400492df9520ca088">LNP_HANDSHAKE_CLOSED</a>,   
<a name="l00071"></a>00071         <a class="code" href="lnp__store_8h.html#62ef170eb4243b31e534d0eabcf4ef03f856bcda6f976ea970a47f58babb2560">LNP_HANDSHAKE_CONNECTING</a>,
<a name="l00073"></a>00073         <a class="code" href="lnp__store_8h.html#62ef170eb4243b31e534d0eabcf4ef0331757303d73896d956f448fabade58ef">LNP_HANDSHAKE_BEING_CONNECTED</a>,
<a name="l00075"></a>00075         <a class="code" href="lnp__store_8h.html#62ef170eb4243b31e534d0eabcf4ef038dd906927c21f3da688d4e125753778b">LNP_HANDSHAKE_EXCHANGING_KEYS</a>,
<a name="l00077"></a>00077         <a class="code" href="lnp__store_8h.html#62ef170eb4243b31e534d0eabcf4ef032625e7ccdd6c2b4ab11fe47ea54378cc">LNP_HANDSHAKE_CONNECTED</a>
<a name="l00078"></a>00078 };
<a name="l00079"></a>00079 
<a name="l00083"></a><a class="code" href="structlnp__key__entry__t.html">00083</a> <span class="keyword">typedef</span> <span class="keyword">struct </span>{
<a name="l00085"></a><a class="code" href="structlnp__key__entry__t.html#e351308d1d459e84800d2439dd742f51">00085</a>         <span class="keywordtype">int</span> packets_sent;
<a name="l00087"></a><a class="code" href="structlnp__key__entry__t.html#1ec32cfd0ac6222555fb9cf8ed633a4e">00087</a>         <span class="keywordtype">int</span> packets_received;
<a name="l00090"></a><a class="code" href="structlnp__key__entry__t.html#e513dbc376020ae0ec72bba1144b4886">00090</a>         <span class="keywordtype">int</span> counter;
<a name="l00092"></a><a class="code" href="structlnp__key__entry__t.html#5b29a791892a85bab27685e214d9f7c9">00092</a>         <span class="keywordtype">int</span> timeout;
<a name="l00094"></a><a class="code" href="structlnp__key__entry__t.html#cc4e7a36e084bb7fc56c8e9258ee0a5a">00094</a>         <span class="keywordtype">int</span> handshake_state;
<a name="l00096"></a><a class="code" href="structlnp__key__entry__t.html#81bf7c133269e550e58c863740390b9f">00096</a>         <span class="keywordtype">int</span> error;
<a name="l00098"></a><a class="code" href="structlnp__key__entry__t.html#dcadf09d5ec913ad7453085a57155f4c">00098</a>         util_cipher_function_t *cipher;
<a name="l00100"></a><a class="code" href="structlnp__key__entry__t.html#df114adb4acd58ed907cb995bcd9d14a">00100</a>         util_hash_function_t *<a class="code" href="lnp__id_8c.html#8605958a008650613d55db78112c6ee5">hash</a>;
<a name="l00102"></a><a class="code" href="structlnp__key__entry__t.html#0afcd858bcecf575109aad1053ebd41a">00102</a>         util_mac_function_t *mac;
<a name="l00104"></a><a class="code" href="structlnp__key__entry__t.html#ac1caecdb34db1d53ce57366ec6a22d6">00104</a>         u_char *cipher_in_key;
<a name="l00106"></a><a class="code" href="structlnp__key__entry__t.html#b055b8405bed589198548c7105674f80">00106</a>         u_char *cipher_in_iv;
<a name="l00108"></a><a class="code" href="structlnp__key__entry__t.html#b11b6ec2b78a33b1532387eddd64c140">00108</a>         u_char *cipher_out_key;
<a name="l00110"></a><a class="code" href="structlnp__key__entry__t.html#cedea83d87db52f0cfe6782a8655dff5">00110</a>         u_char *cipher_out_iv;
<a name="l00112"></a><a class="code" href="structlnp__key__entry__t.html#0c7951c9c384a233968fcc9f5c84e696">00112</a>         u_char *mac_in_key;
<a name="l00114"></a><a class="code" href="structlnp__key__entry__t.html#5e8d05007be5b16370d63cbc25d4a30b">00114</a>         u_char *mac_out_key;
<a name="l00116"></a><a class="code" href="structlnp__key__entry__t.html#2edc7682cc3f6e91a15ebaf8b7ca0394">00116</a>         <span class="keywordtype">int</span> next_free_slot;
<a name="l00118"></a><a class="code" href="structlnp__key__entry__t.html#6f4cb960c26b441d3e6adaa3c7c3bc11">00118</a>         u_char k_in[<a class="code" href="lnp__packets_8h.html#dbd5424fe6358f45616bdf73eb5942e0">LNP_K_LENGTH</a>];
<a name="l00120"></a><a class="code" href="structlnp__key__entry__t.html#26c4cff3fcc7e53213e9cedbf5244bec">00120</a>         u_char k_out[<a class="code" href="lnp__packets_8h.html#dbd5424fe6358f45616bdf73eb5942e0">LNP_K_LENGTH</a>];
<a name="l00122"></a><a class="code" href="structlnp__key__entry__t.html#a66d5f39a3806a4c8aaf244d597d3518">00122</a>         u_char encrypted_k_in[<a class="code" href="lnp__packets_8h.html#dbd5424fe6358f45616bdf73eb5942e0">LNP_K_LENGTH</a>];
<a name="l00124"></a><a class="code" href="structlnp__key__entry__t.html#f5812c08197cc577fca65ef0336c1f83">00124</a>         u_char encrypted_k_out[<a class="code" href="lnp__packets_8h.html#dbd5424fe6358f45616bdf73eb5942e0">LNP_K_LENGTH</a>];
<a name="l00126"></a><a class="code" href="structlnp__key__entry__t.html#3e6db407bf12a48a95b5f92c996fcf45">00126</a>         u_char public_key[<a class="code" href="lnp__packets_8h.html#9e27b8c6a1c8bb6448937268cb916dd9">LNP_PUBLIC_KEY_LENGTH</a>];
<a name="l00128"></a>00128         <span class="comment">/*pthread_cond_t handshake_condition;*/</span>
<a name="l00130"></a>00130         <span class="comment">/*pthread_mutex_t handshake_mutex;*/</span>
<a name="l00131"></a>00131 } <a class="code" href="structlnp__key__entry__t.html">lnp_key_entry_t</a>;
<a name="l00132"></a>00132 
<a name="l00137"></a>00137 <span class="keyword">extern</span> <a class="code" href="structlnp__key__entry__t.html">lnp_key_entry_t</a> <a class="code" href="lnp__store_8c.html#49d286d6c7cb58c7da6321b991321649">lnp_key_store</a>[<a class="code" href="lnp__store_8h.html#c25344f711611c26e700f906ace6ba8e">KEY_TABLE_SIZE</a>];
<a name="l00138"></a>00138 
<a name="l00144"></a>00144 <span class="keywordtype">int</span> <a class="code" href="lnp__store_8c.html#ea82a810a1f6cedfe0da0cb697bd4208">lnp_key_store_initialize</a>();
<a name="l00145"></a>00145 
<a name="l00149"></a>00149 <span class="keywordtype">void</span> <a class="code" href="lnp__store_8c.html#bc1e090941524dbc86c8eb521b11e1f0">lnp_key_store_finalize</a>();
<a name="l00150"></a>00150 
<a name="l00154"></a>00154 <span class="keywordtype">int</span> <a class="code" href="lnp__store_8c.html#22baee56ba85fd15930f8b84aee33fa4">lnp_key_store_new</a>();
<a name="l00155"></a>00155 
<a name="l00159"></a>00159 <span class="keywordtype">void</span> <a class="code" href="lnp__store_8c.html#f51e0fb65d28e68f5fd7197b19204a2e">lnp_key_store_delete</a>(<span class="keywordtype">int</span> key_entry_index);
<a name="l00160"></a>00160 
<a name="l00164"></a>00164 <span class="keywordtype">int</span> <a class="code" href="lnp__store_8c.html#320ce6d679508ee4825e632de55be5c1">lnp_set_cipher_in_key</a>(<span class="keywordtype">int</span> index, u_char *key);
<a name="l00168"></a>00168 <span class="keywordtype">int</span> <a class="code" href="lnp__store_8c.html#62cd12f8548658972ae20088e91cc976">lnp_set_cipher_in_iv</a>(<span class="keywordtype">int</span> index, u_char *iv);
<a name="l00172"></a>00172 <span class="keywordtype">int</span> <a class="code" href="lnp__store_8c.html#5827b8c409357329bc063f81ea46157b">lnp_set_cipher_out_key</a>(<span class="keywordtype">int</span> index, u_char *key);
<a name="l00176"></a>00176 <span class="keywordtype">int</span> <a class="code" href="lnp__store_8c.html#0be9a23d1dfbc27e1351bc4f5928a9ec">lnp_set_cipher_out_iv</a>(<span class="keywordtype">int</span> index, u_char *iv);
<a name="l00180"></a>00180 <span class="keywordtype">int</span> <a class="code" href="lnp__store_8c.html#b8b930cfa2759850db24e0c91c0553d4">lnp_set_mac_in_key</a>(<span class="keywordtype">int</span> index, u_char *key);
<a name="l00184"></a>00184 <span class="keywordtype">int</span> <a class="code" href="lnp__store_8c.html#e5d2a9328a358bf8645e9d430da191be">lnp_set_mac_out_key</a>(<span class="keywordtype">int</span> index, u_char *key);
<a name="l00185"></a>00185 
<a name="l00186"></a>00186 
<a name="l00187"></a>00187 <span class="preprocessor">#endif </span><span class="comment">/* !_LNP_STORE_H_ */</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Tue Mar 20 00:15:38 2007 for Kurupira by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.1 </small></address>
</body>
</html>
