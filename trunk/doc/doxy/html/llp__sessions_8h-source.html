<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Kurupira: /usr/home/iamscared/projects/kurupira/src/llp/llp_sessions.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.1 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>Globals</span></a></li>
  </ul></div>
<h1>/usr/home/iamscared/projects/kurupira/src/llp/llp_sessions.h</h1><a href="llp__sessions_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * Copyright (C) by The Freecolony Project.</span>
<a name="l00003"></a>00003 <span class="comment"> * Please refer to the COPYRIGHT file distributed with this source</span>
<a name="l00004"></a>00004 <span class="comment"> * distribution.</span>
<a name="l00005"></a>00005 <span class="comment"> * </span>
<a name="l00006"></a>00006 <span class="comment"> * This program is free software; you can redistribute it and/or modify</span>
<a name="l00007"></a>00007 <span class="comment"> * it under the terms of the GNU General Public License as published by</span>
<a name="l00008"></a>00008 <span class="comment"> * the Free Software Foundation; either version 2 of the License, or</span>
<a name="l00009"></a>00009 <span class="comment"> * (at your option) any later version.</span>
<a name="l00010"></a>00010 <span class="comment"> * </span>
<a name="l00011"></a>00011 <span class="comment"> * This program is distributed in the hope that it will be useful,</span>
<a name="l00012"></a>00012 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00013"></a>00013 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00014"></a>00014 <span class="comment"> * GNU General Public License for more details.</span>
<a name="l00015"></a>00015 <span class="comment"> * </span>
<a name="l00016"></a>00016 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
<a name="l00017"></a>00017 <span class="comment"> * along with this program; if not, write to the</span>
<a name="l00018"></a>00018 <span class="comment"> * Free Software Foundation, Inc.,</span>
<a name="l00019"></a>00019 <span class="comment"> * 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.</span>
<a name="l00020"></a>00020 <span class="comment"> */</span>
<a name="l00021"></a>00021  
<a name="l00027"></a>00027 <span class="preprocessor">#ifndef _LLP_SESSIONS_H_</span>
<a name="l00028"></a>00028 <span class="preprocessor"></span><span class="preprocessor">#define _LLP_SESSIONS_H_</span>
<a name="l00029"></a>00029 <span class="preprocessor"></span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &lt;netinet/in.h&gt;</span>
<a name="l00031"></a>00031 
<a name="l00032"></a>00032 <span class="preprocessor">#include &lt;pthread.h&gt;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;openssl/bn.h&gt;</span>
<a name="l00034"></a>00034 
<a name="l00035"></a>00035 <span class="preprocessor">#include &lt;libfreedom/types.h&gt;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &lt;util/util_crypto.h&gt;</span>
<a name="l00037"></a>00037 
<a name="l00038"></a>00038 <span class="preprocessor">#include "<a class="code" href="llp__packets_8h.html">llp_packets.h</a>"</span>
<a name="l00039"></a>00039 
<a name="l00043"></a><a class="code" href="llp__sessions_8h.html#89d066eed7803fb8dceddabfdddf432b">00043</a> <span class="preprocessor">#define LLP_MAX_SESSIONS        256</span>
<a name="l00044"></a>00044 <span class="preprocessor"></span>
<a name="l00048"></a><a class="code" href="llp__sessions_8h.html#c6c611a4a85f7b2d3b3fc213b97e80de">00048</a> <span class="keyword">enum</span> <a class="code" href="llp__sessions_8h.html#c6c611a4a85f7b2d3b3fc213b97e80de">llp_states</a> {
<a name="l00049"></a>00049         <a class="code" href="llp__sessions_8h.html#c6c611a4a85f7b2d3b3fc213b97e80de8e03cd1d09016a938083b736763cd7bd">LLP_STATE_CLOSED</a>,                               
<a name="l00050"></a>00050         <a class="code" href="llp__sessions_8h.html#c6c611a4a85f7b2d3b3fc213b97e80dea0cdbf5afeeb1b7e43c82489be9f4fe7">LLP_STATE_CONNECTING</a>,                   
<a name="l00051"></a>00051         <a class="code" href="llp__sessions_8h.html#c6c611a4a85f7b2d3b3fc213b97e80de523d9fd1087805042a5d01a14728c119">LLP_STATE_BEING_CONNECTED</a>,              
<a name="l00052"></a>00052         <a class="code" href="llp__sessions_8h.html#c6c611a4a85f7b2d3b3fc213b97e80deec73b365db22b1ca5d7ee54bfcf23a5b">LLP_STATE_ESTABLISHED</a>,                  
<a name="l00053"></a>00053         <a class="code" href="llp__sessions_8h.html#c6c611a4a85f7b2d3b3fc213b97e80de41a33cc29d2d9ec0909f305c3e82ec70">LLP_STATE_CLOSE_WAIT</a>,                   
<a name="l00054"></a><a class="code" href="llp__sessions_8h.html#c6c611a4a85f7b2d3b3fc213b97e80de8e77226abf197ebaae0106f34f18a2d4">00054</a>         <a class="code" href="llp__sessions_8h.html#c6c611a4a85f7b2d3b3fc213b97e80de8e77226abf197ebaae0106f34f18a2d4">LLP_STATE_TIME_WAIT</a>                             
<a name="l00055"></a>00055 };
<a name="l00056"></a>00056 
<a name="l00061"></a>00061 <span class="keyword">extern</span> <span class="keywordtype">char</span> *<a class="code" href="llp__sessions_8h.html#c6c611a4a85f7b2d3b3fc213b97e80de">llp_states</a>[];
<a name="l00062"></a>00062 
<a name="l00066"></a><a class="code" href="llp__sessions_8h.html#624f6120269c7f32e3a56fef24b58af1">00066</a> <span class="preprocessor">#define LLP_SESSION_ENCRYPTED           1</span>
<a name="l00067"></a>00067 <span class="preprocessor"></span>
<a name="l00070"></a><a class="code" href="llp__sessions_8h.html#4a41211fb634bcb51b270a3a9e9dcbcb">00070</a> <span class="preprocessor">#define LLP_SESSION_NOT_ENCRYPTED       0</span>
<a name="l00071"></a>00071 <span class="preprocessor"></span>
<a name="l00075"></a><a class="code" href="llp__sessions_8h.html#950c76a192984318bca3aea8857d42a7">00075</a> <span class="preprocessor">#define LLP_TIME_TICK                                   500</span>
<a name="l00076"></a>00076 <span class="preprocessor"></span>
<a name="l00079"></a><a class="code" href="llp__sessions_8h.html#b095e67fca0638b0438af52f702a357e">00079</a> <span class="preprocessor">#define LLP_TIME_TICKS_PER_SECOND               (1000/LLP_TIME_TICK)</span>
<a name="l00080"></a>00080 <span class="preprocessor"></span>
<a name="l00083"></a><a class="code" href="llp__sessions_8h.html#2e4b33b461d3adbf8890c7a74ebad478">00083</a> <span class="preprocessor">#define LLP_T_TIMEOUT   (30*LLP_TIME_TICKS_PER_SECOND)</span>
<a name="l00084"></a>00084 <span class="preprocessor"></span>
<a name="l00087"></a><a class="code" href="llp__sessions_8h.html#f00cdb664fc9c743403f33c03320903e">00087</a> <span class="preprocessor">#define LLP_T_SILENT    (LLP_T_TIMEOUT/2 - LLP_TIME_TICKS_PER_SECOND)</span>
<a name="l00088"></a>00088 <span class="preprocessor"></span>
<a name="l00092"></a><a class="code" href="structllp__session__t.html">00092</a> <span class="keyword">typedef</span> <span class="keyword">struct </span>{
<a name="l00094"></a><a class="code" href="structllp__session__t.html#e827d39b8c17e74c3ee558c5f30bc3ba">00094</a>         <span class="keywordtype">int</span> state;
<a name="l00096"></a><a class="code" href="structllp__session__t.html#ab010a5809030a259905e632da2f085f">00096</a>         <span class="keyword">struct </span>sockaddr_in address;
<a name="l00098"></a><a class="code" href="structllp__session__t.html#fbd1d6410f6699b32c09afce5a1e9d12">00098</a>         <span class="keywordtype">int</span> packets_sent;
<a name="l00100"></a><a class="code" href="structllp__session__t.html#65c636a1da8097e7818f670f3bda6dee">00100</a>         <span class="keywordtype">int</span> packets_received;
<a name="l00102"></a><a class="code" href="structllp__session__t.html#dbd07ce51b76bd9870f55cc2a2230718">00102</a>         <span class="keywordtype">int</span> encrypted;
<a name="l00104"></a><a class="code" href="structllp__session__t.html#18ca4887b529481ab406a6774da56a11">00104</a>         <span class="keywordtype">int</span> timeout;
<a name="l00106"></a><a class="code" href="structllp__session__t.html#655b687b7d72e0fbb72c6898271d305a">00106</a>         <span class="keywordtype">int</span> silence;
<a name="l00108"></a><a class="code" href="structllp__session__t.html#84aa4c1e6d5a8d01067b5d1644228240">00108</a>         <span class="keywordtype">long</span> hunt_time;
<a name="l00110"></a><a class="code" href="structllp__session__t.html#4c6e2e26dd2790f4bcaa25852ecf6824">00110</a>         <span class="keywordtype">int</span> alive;
<a name="l00112"></a><a class="code" href="structllp__session__t.html#7be1169e13319e788a45ebb2e44d8ef8">00112</a>         <span class="keywordtype">int</span> error;
<a name="l00114"></a><a class="code" href="structllp__session__t.html#e7d8d2b83cbede4a8987eb49f69a7daf">00114</a>         <span class="keywordtype">int</span> foreign_session;
<a name="l00116"></a><a class="code" href="structllp__session__t.html#c9ee0435f3882d3c61bea48583ad089c">00116</a>         util_cipher_function_t *cipher;
<a name="l00118"></a><a class="code" href="structllp__session__t.html#cf551e34435307a8898e65004fc43454">00118</a>         util_hash_function_t *<a class="code" href="lnp__id_8c.html#8605958a008650613d55db78112c6ee5">hash</a>;
<a name="l00120"></a><a class="code" href="structllp__session__t.html#1bc2a94dfca982c39e1bd34883bae370">00120</a>         util_mac_function_t *mac;
<a name="l00122"></a><a class="code" href="structllp__session__t.html#c087a6e400c53c0b4d30b5c8cb646cd3">00122</a>         u_char *cipher_in_key;
<a name="l00124"></a><a class="code" href="structllp__session__t.html#12eb46a7dc81856b79f0ce8b21e1ed31">00124</a>         u_char *cipher_in_iv;
<a name="l00126"></a><a class="code" href="structllp__session__t.html#36730722fd8119288d72f9c9809d4586">00126</a>         u_char *cipher_out_key;
<a name="l00128"></a><a class="code" href="structllp__session__t.html#5e68cbd0cc9389153f7897d5998d4b77">00128</a>         u_char *cipher_out_iv;
<a name="l00130"></a><a class="code" href="structllp__session__t.html#b9a8411f037cbc233afcfa1ea9bc32e6">00130</a>         u_char *mac_in_key;
<a name="l00132"></a><a class="code" href="structllp__session__t.html#7eb68ac8b9dcb1c328bbc97385051d66">00132</a>         u_char *mac_out_key;
<a name="l00134"></a><a class="code" href="structllp__session__t.html#fadc407f71ce73b89a921faf3c1b940b">00134</a>         u_char h_in[<a class="code" href="llp__packets_8h.html#71efbf174885b97a19a8c9db6c560f44">LLP_H_LENGTH</a>];
<a name="l00136"></a><a class="code" href="structllp__session__t.html#e39a4e5059bb74cc2755469e664ca56b">00136</a>         u_char h_out[<a class="code" href="llp__packets_8h.html#71efbf174885b97a19a8c9db6c560f44">LLP_H_LENGTH</a>];
<a name="l00138"></a><a class="code" href="structllp__session__t.html#b8411f995a294fadd79ba3e61fbfbf21">00138</a>         u_char y_in[<a class="code" href="llp__packets_8h.html#dab3b853e8c964cc479f9112c2a12f86">LLP_Y_LENGTH</a>];
<a name="l00140"></a><a class="code" href="structllp__session__t.html#6c6946cc4f11d28e644d9286d8eb8dff">00140</a>         u_char y_out[<a class="code" href="llp__packets_8h.html#dab3b853e8c964cc479f9112c2a12f86">LLP_Y_LENGTH</a>];
<a name="l00142"></a><a class="code" href="structllp__session__t.html#00989ec012108f002b917b0bd45d386a">00142</a>         u_char x[<a class="code" href="llp__packets_8h.html#8963feb6039c4af9ca87e18500bfb43f">LLP_X_LENGTH</a>];
<a name="l00144"></a><a class="code" href="structllp__session__t.html#f13002dc6d29c2a668a858edc2675e1d">00144</a>         u_char z[<a class="code" href="llp__packets_8h.html#d3d5a2a04e0b9b94887c7d86d56ca687">LLP_Z_LENGTH</a>];
<a name="l00146"></a><a class="code" href="structllp__session__t.html#394063575c924bad827a14814167e2fb">00146</a>         u_char *verifier;
<a name="l00147"></a>00147 } <a class="code" href="structllp__session__t.html">llp_session_t</a>;
<a name="l00148"></a>00148 
<a name="l00153"></a>00153 <span class="keyword">extern</span> <a class="code" href="structllp__session__t.html">llp_session_t</a> <a class="code" href="llp__sessions_8c.html#40248483d92e37784453ca428cd38810">llp_sessions</a>[<a class="code" href="llp__sessions_8h.html#89d066eed7803fb8dceddabfdddf432b">LLP_MAX_SESSIONS</a>];
<a name="l00154"></a>00154 
<a name="l00158"></a>00158 <span class="keyword">extern</span> pthread_mutex_t <a class="code" href="llp__sessions_8c.html#58d2b75f0db8e5ad33721d803190adda">llp_sessions_mutexes</a>[<a class="code" href="llp__sessions_8h.html#89d066eed7803fb8dceddabfdddf432b">LLP_MAX_SESSIONS</a>];
<a name="l00159"></a>00159 
<a name="l00166"></a>00166 <span class="keywordtype">int</span> <a class="code" href="llp__sessions_8c.html#f41abab60754fd9da1f8303dd3f70146">llp_sessions_initialize</a>();
<a name="l00167"></a>00167 
<a name="l00171"></a>00171 <span class="keywordtype">void</span> <a class="code" href="llp__sessions_8c.html#8d5c1b32ab162d51a10e27cf25ca288a">llp_sessions_finalize</a>();
<a name="l00172"></a>00172 
<a name="l00178"></a><a class="code" href="llp__sessions_8h.html#02e18a35f5c25ef60d335e04a5656ad3">00178</a> <span class="preprocessor">#define llp_lock_session(session)       \</span>
<a name="l00179"></a>00179 <span class="preprocessor">                pthread_mutex_lock(&amp;llp_sessions_mutexes[session])</span>
<a name="l00180"></a>00180 <span class="preprocessor"></span>                
<a name="l00186"></a><a class="code" href="llp__sessions_8h.html#a28b309908dfcd3f4c2260147f27e04b">00186</a> <span class="preprocessor">#define llp_unlock_session(session)     \</span>
<a name="l00187"></a>00187 <span class="preprocessor">                pthread_mutex_unlock(&amp;llp_sessions_mutexes[session])</span>
<a name="l00188"></a>00188 <span class="preprocessor"></span>
<a name="l00196"></a>00196 <span class="keywordtype">int</span> <a class="code" href="llp__sessions_8c.html#e15a735b1bbf1fd00e09ace38d7b08ba">llp_set_cipher_in_key</a>(<span class="keywordtype">int</span> session, u_char *key);
<a name="l00197"></a>00197 
<a name="l00205"></a>00205 <span class="keywordtype">int</span> <a class="code" href="llp__sessions_8c.html#a584c635e614645b5ae8f85ea53739ef">llp_set_cipher_in_iv</a>(<span class="keywordtype">int</span> session, u_char *iv);
<a name="l00206"></a>00206 
<a name="l00214"></a>00214 <span class="keywordtype">int</span> <a class="code" href="llp__sessions_8c.html#8fa7400895e304b6b418c8967978fa3c">llp_set_cipher_out_key</a>(<span class="keywordtype">int</span> session, u_char *key);
<a name="l00215"></a>00215 
<a name="l00223"></a>00223 <span class="keywordtype">int</span> <a class="code" href="llp__sessions_8c.html#25cb3911fb15a84a93af1de3f6ad7fcd">llp_set_cipher_out_iv</a>(<span class="keywordtype">int</span> session, u_char *iv);
<a name="l00224"></a>00224 
<a name="l00232"></a>00232 <span class="keywordtype">int</span> <a class="code" href="llp__sessions_8c.html#4eb5fc10c840c653fa839d79aacadb24">llp_set_mac_in_key</a>(<span class="keywordtype">int</span> session, u_char *key);
<a name="l00233"></a>00233 
<a name="l00241"></a>00241 <span class="keywordtype">int</span> <a class="code" href="llp__sessions_8c.html#1b04b30a6bbeb177a81d6cb33d6a4007">llp_set_mac_out_key</a>(<span class="keywordtype">int</span> session, u_char *key);
<a name="l00242"></a>00242 
<a name="l00250"></a>00250 <span class="keywordtype">int</span> <a class="code" href="llp__sessions_8c.html#836c249a7caf23ee2829856c05f2769c">llp_set_verifier</a>(<span class="keywordtype">int</span> session, u_char *verifier);
<a name="l00251"></a>00251 
<a name="l00255"></a>00255 <span class="keywordtype">void</span> <a class="code" href="llp__sessions_8c.html#29e374d66aa44f4685c9e30fc52bc170">llp_close_session</a>(<span class="keywordtype">int</span> session);
<a name="l00256"></a>00256 
<a name="l00264"></a>00264 <span class="keywordtype">int</span> <a class="code" href="llp__sessions_8c.html#492d055ebad525607c655a897322d017">llp_get_free_session</a>(<span class="keywordtype">int</span> next_state);
<a name="l00265"></a>00265 
<a name="l00269"></a>00269 <span class="keywordtype">int</span> <a class="code" href="llp__sessions_8c.html#41f34cb1ec70c7df2d2201d57071d6f2">llp_get_last_error</a>(<span class="keywordtype">int</span> session);
<a name="l00270"></a>00270 
<a name="l00274"></a>00274 <span class="keywordtype">void</span> <a class="code" href="llp__sessions_8c.html#ba0cfbe6796a38a5559417bd76c75c70">llp_handle_timeouts</a>();
<a name="l00275"></a>00275 
<a name="l00279"></a>00279 <span class="keywordtype">void</span> <a class="code" href="llp__sessions_8c.html#3dac3ca5b96285538a9d5422165e8447">llp_handle_silence</a>();
<a name="l00280"></a>00280 
<a name="l00284"></a>00284 <span class="keywordtype">void</span> <a class="code" href="llp__sessions_8c.html#acd8f3841ab7bb3462f69a1b53a8161c">llp_handle_connections</a>();
<a name="l00285"></a>00285 
<a name="l00286"></a>00286 <span class="preprocessor">#endif </span><span class="comment">/* !_LLP_SESSIONS_H_ */</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Tue Mar 20 00:15:38 2007 for Kurupira by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.1 </small></address>
</body>
</html>
